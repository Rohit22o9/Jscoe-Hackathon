<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Innovation Portal | IIC 2K26</title>
    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Orbitron:wght@400;500;600;700;800;900&display=swap"
        rel="stylesheet">
    <link rel="icon" type="image/jpeg" href="logo.jpeg">
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        dark: '#050505',
                        'navy-dark': '#000814',
                        'neon-blue': '#00d4ff',
                        'neon-purple': '#9b5de5',
                        'accent-yellow': '#eab308',
                    },
                    fontFamily: {
                        orbitron: ['Orbitron', 'sans-serif'],
                        inter: ['Inter', 'sans-serif'],
                    }
                }
            }
        }
    </script>
    <link rel="stylesheet" href="style.css">
    <style>
        .sidebar {
            width: 300px;
            background: #000814;
            border-right: 1px solid rgba(255, 255, 255, 0.05);
            height: 100vh;
            position: fixed;
            left: 0;
            top: 0;
            z-index: 50;
            display: flex;
            flex-direction: column;
        }

        .sidebar-link {
            display: flex;
            align-items: center;
            gap: 1rem;
            padding: 1rem 1.5rem;
            color: rgba(255, 255, 255, 0.5);
            font-weight: 600;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            border-radius: 1rem;
            margin-bottom: 0.5rem;
            cursor: pointer;
            border: 1px solid transparent;
        }

        .sidebar-link:hover {
            color: #00d4ff;
            background: rgba(0, 212, 255, 0.05);
            border-color: rgba(0, 212, 255, 0.1);
        }

        .sidebar-link.active {
            background: #eab308;
            color: #050505;
            box-shadow: 0 0 20px rgba(234, 179, 8, 0.3);
        }

        .main-content {
            margin-left: 300px;
            min-height: 100vh;
            padding: 2.5rem;
            background: #050505;
            position: relative;
        }

        .content-view.hidden {
            display: none;
        }

        .portal-card {
            background: rgba(255, 255, 255, 0.03);
            backdrop-filter: blur(12px);
            border: 1px solid rgba(255, 255, 255, 0.08);
            border-radius: 2rem;
            padding: 2.5rem;
            transition: all 0.3s ease;
        }

        .portal-card:hover {
            border-color: rgba(0, 212, 255, 0.2);
        }

        .status-badge {
            padding: 0.35rem 0.85rem;
            border-radius: 9999px;
            font-size: 10px;
            font-weight: 800;
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }

        input,
        select,
        textarea {
            background: rgba(255, 255, 255, 0.05) !important;
            border: 1px solid rgba(255, 255, 255, 0.1) !important;
            color: white !important;
            border-radius: 1rem !important;
            padding: 1rem 1.5rem !important;
            outline: none !important;
            transition: all 0.3s ease !important;
            width: 100%;
        }

        input:focus {
            border-color: #00d4ff !important;
            box-shadow: 0 0 15px rgba(0, 212, 255, 0.2) !important;
        }

        .checkbox-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 1rem;
        }

        .theme-checkbox {
            display: flex;
            align-items: center;
            gap: 1rem;
            padding: 1rem;
            background: rgba(255, 255, 255, 0.02);
            border: 1px solid rgba(255, 255, 255, 0.05);
            border-radius: 1rem;
            cursor: pointer;
            transition: all 0.2s;
        }

        .theme-checkbox:hover {
            background: rgba(255, 255, 255, 0.05);
            border-color: rgba(255, 255, 255, 0.1);
        }

        .theme-checkbox input:checked+.box {
            background: #00d4ff;
            border-color: #00d4ff;
        }

        .theme-checkbox input:checked+.box i {
            display: block;
        }

        .box {
            width: 1.25rem;
            height: 1.25rem;
            border: 2px solid rgba(255, 255, 255, 0.2);
            border-radius: 0.4rem;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s;
        }

        .box i {
            display: none;
            color: #050505;
            font-size: 0.75rem;
        }

        .custom-scrollbar::-webkit-scrollbar {
            width: 6px;
        }

        .custom-scrollbar::-webkit-scrollbar-track {
            background: transparent;
        }

        .custom-scrollbar::-webkit-scrollbar-thumb {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
        }
    </style>
</head>

<body class="font-inter text-white bg-dark">
    <div class="fixed inset-0 grid-bg opacity-20 pointer-events-none"></div>

    <!-- Sidebar -->
    <aside class="sidebar p-8">
        <div class="flex items-center gap-4 mb-12 px-2">
            <img src="logo.jpeg" alt="Logo"
                class="w-12 h-12 rounded-xl border border-white/10 shadow-lg shadow-neon-blue/20">
            <div class="flex flex-col">
                <span class="font-orbitron font-black text-xl tracking-tighter text-white uppercase">IIC 2K26</span>
                <span class="text-[9px] uppercase tracking-[0.3em] text-neon-blue font-bold">Innovation Panel</span>
            </div>
        </div>

        <nav class="flex-1 overflow-y-auto pr-2 custom-scrollbar">
            <div class="sidebar-link active" data-view="dashboard"><i data-lucide="layout-dashboard"
                    class="w-5 h-5"></i>Dashboard</div>
            <div class="sidebar-link" data-view="registrations"><i data-lucide="file-text" class="w-5 h-5"></i>Teams
                Registration</div>
            <div class="sidebar-link" data-view="teams"><i data-lucide="users" class="w-5 h-5"></i>Teams Allocation
            </div>
            <div class="sidebar-link" data-view="idea"><i data-lucide="lightbulb" class="w-5 h-5"></i>Idea Submissions
            </div>
            <div class="sidebar-link" data-view="evaluators"><i data-lucide="user-plus" class="w-5 h-5"></i>Evaluator
                Registration</div>
            <div class="sidebar-link" data-view="assignments"><i data-lucide="user-check" class="w-5 h-5"></i>Evaluator
                Assignment</div>
            <div class="sidebar-link" data-view="sh"><i data-lucide="shield-check" class="w-5 h-5"></i>SH Registration
            </div>
            <div class="sidebar-link" data-view="notices"><i data-lucide="bell" class="w-5 h-5"></i>Notices</div>
        </nav>

        <div class="mt-8 pt-6 border-t border-white/5">
            <button onclick="window.location.href='login.html'"
                class="w-full bg-accent-yellow text-dark font-black py-4 rounded-2xl flex items-center justify-center gap-3 hover:scale-[1.02] transition-all shadow-lg shadow-yellow-500/20 active:scale-95">
                <i data-lucide="log-out" class="w-5 h-5"></i>LOGOUT
            </button>
        </div>
    </aside>

    <!-- Main Content -->
    <main class="main-content relative">
        <!-- Floating College Logos -->
        <div class="absolute top-2 left-6 z-10 opacity-50 hover:opacity-100 transition-opacity">
            <img src="jspm-logo.png" alt="JSPM" class="h-12 w-auto object-contain">
        </div>
        <div class="absolute top-2 right-6 z-10 opacity-50 hover:opacity-100 transition-opacity">
            <img src="jscoe-logo.png" alt="JSCOE" class="h-12 w-auto object-contain">
        </div>

        <!-- Header -->
        <header class="flex justify-between items-center mb-12 glass p-6 border-white/5 rounded-[2rem]">
            <div class="flex flex-col">
                <h2 class="text-3xl font-orbitron font-black text-white uppercase tracking-tight" id="section-title">
                    Admin Dashboard</h2>
                <div class="flex items-center gap-2 mt-1">
                    <span class="w-2 h-2 rounded-full bg-neon-blue animate-pulse"></span>
                    <p class="text-neon-blue text-[11px] font-bold uppercase tracking-[0.2em]" id="section-subtitle">
                        System Overview and Real-time Metrics</p>
                </div>
            </div>

            <div
                class="flex items-center gap-5 px-6 py-3 bg-white/5 border border-white/10 rounded-[2rem] hover:border-neon-blue/30 transition-all group">
                <div class="flex flex-col text-right">
                    <span class="text-xs font-black text-white group-hover:text-neon-blue transition-colors">Admin JSCOE
                        Waghole Sir</span>
                    <span class="text-[9px] text-white/40 font-bold uppercase tracking-widest">Master
                        Administrator</span>
                </div>
                <div
                    class="w-12 h-12 bg-gradient-to-br from-neon-blue to-neon-purple rounded-2xl flex items-center justify-center text-white shadow-lg overflow-hidden relative">
                    <div class="absolute inset-0 bg-black/10"></div>
                    <i data-lucide="user" class="w-6 h-6 relative z-10"></i>
                </div>
            </div>
        </header>

        <!-- DASHBOARD VIEW -->
        <div id="view-dashboard" class="content-view space-y-10">
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-6 gap-6">
                <div class="portal-card relative overflow-hidden group p-6">
                    <div class="flex justify-between items-baseline mb-6">
                        <span class="text-[10px] font-black text-white/40 uppercase tracking-[0.2em]">Total Teams</span>
                        <div class="p-2 bg-neon-blue/10 rounded-lg text-neon-blue"><i data-lucide="users"
                                class="w-4 h-4"></i></div>
                    </div>
                    <div class="text-4xl font-orbitron font-black text-white">0</div>
                </div>
                <div class="portal-card relative overflow-hidden group p-6">
                    <div class="flex justify-between items-baseline mb-6">
                        <span class="text-[10px] font-black text-white/40 uppercase tracking-[0.2em]">Total Apps</span>
                        <div class="p-2 bg-neon-purple/10 rounded-lg text-neon-purple"><i data-lucide="file-text"
                                class="w-4 h-4"></i></div>
                    </div>
                    <div class="text-4xl font-orbitron font-black text-white">0</div>
                </div>
                <div class="portal-card relative overflow-hidden group p-6 border-orange-500/20">
                    <div class="flex justify-between items-baseline mb-6">
                        <span class="text-[10px] font-black text-white/40 uppercase tracking-[0.2em]">Pending
                            Review</span>
                        <div class="p-2 bg-orange-500/10 rounded-lg text-orange-500"><i data-lucide="clock"
                                class="w-4 h-4"></i></div>
                    </div>
                    <div class="text-4xl font-orbitron font-black text-orange-500">0</div>
                </div>
                <div class="portal-card relative overflow-hidden group p-6 border-green-500/20">
                    <div class="flex justify-between items-baseline mb-6">
                        <span class="text-[10px] font-black text-white/40 uppercase tracking-[0.2em]">Selected
                            Teams</span>
                        <div class="p-2 bg-green-500/10 rounded-lg text-green-500"><i data-lucide="check-circle"
                                class="w-4 h-4"></i></div>
                    </div>
                    <div class="text-4xl font-orbitron font-black text-green-500">0</div>
                </div>
                <div class="portal-card relative overflow-hidden group p-6 border-red-500/20">
                    <div class="flex justify-between items-baseline mb-6">
                        <span class="text-[10px] font-black text-white/40 uppercase tracking-[0.2em]">Rejected
                            Teams</span>
                        <div class="p-2 bg-red-500/10 rounded-lg text-red-500"><i data-lucide="x-circle"
                                class="w-4 h-4"></i></div>
                    </div>
                    <div class="text-4xl font-orbitron font-black text-red-500">0</div>
                </div>
                <div class="portal-card relative overflow-hidden group p-6 border-yellow-400/20">
                    <div class="flex justify-between items-baseline mb-6">
                        <span class="text-[10px] font-black text-white/40 uppercase tracking-[0.2em]">Active
                            Evaluators</span>
                        <div class="p-2 bg-yellow-400/10 rounded-lg text-yellow-400"><i data-lucide="award"
                                class="w-4 h-4"></i></div>
                    </div>
                    <div class="text-4xl font-orbitron font-black text-yellow-400">0</div>
                </div>
            </div>

            <div class="portal-card border-none bg-white/[0.02]">
                <h3 class="flex items-center gap-3 text-lg font-orbitron font-black text-white uppercase italic mb-10">
                    <i data-lucide="bar-chart-3" class="w-6 h-6 text-neon-blue"></i>Project Status Overview
                </h3>
                <div class="grid grid-cols-1 md:grid-cols-3 gap-10">
                    <div class="p-10 rounded-[2.5rem] bg-white/5 border border-white/5 flex flex-col items-center">
                        <div class="text-5xl font-orbitron font-black text-neon-blue mb-2">0</div>
                        <span class="text-[10px] font-black text-white/40 uppercase tracking-widest">Total
                            Projects</span>
                    </div>
                    <div class="p-10 rounded-[2.5rem] bg-white/5 border border-white/5 flex flex-col items-center">
                        <div class="text-5xl font-orbitron font-black text-yellow-400 mb-2">0</div>
                        <span class="text-[10px] font-black text-white/40 uppercase tracking-widest">Pending
                            Evaluation</span>
                    </div>
                    <div class="p-10 rounded-[2.5rem] bg-white/5 border border-white/5 flex flex-col items-center">
                        <div class="text-5xl font-orbitron font-black text-green-500 mb-2">0</div>
                        <span class="text-[10px] font-black text-white/40 uppercase tracking-widest">High Score
                            (70+)</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- REGISTRATIONS VIEW -->
        <div id="view-registrations" class="content-view hidden">
            <div class="portal-card p-0 border-none bg-white/[0.02] overflow-hidden">
                <div class="p-8 border-b border-white/5 flex gap-4">
                    <button
                        class="px-6 py-3 bg-white text-dark rounded-xl text-xs font-black uppercase tracking-widest">All
                        Teams</button>
                    <button
                        class="px-6 py-3 bg-neon-purple/20 text-neon-purple border border-neon-purple/30 rounded-xl text-xs font-black uppercase tracking-widest">Ready
                        for Evaluation</button>
                </div>
                <div class="overflow-x-auto">
                    <table class="w-full text-left border-collapse">
                        <thead>
                            <tr
                                class="bg-white/[0.03] text-white/30 text-[10px] font-black uppercase tracking-[0.2em] border-b border-white/5">
                                <th class="px-8 py-5">Team Name</th>
                                <th class="px-8 py-5">Leader</th>
                                <th class="px-8 py-5">Theme</th>
                                <th class="px-8 py-5">Status</th>
                                <th class="px-8 py-5 text-center">Actions</th>
                            </tr>
                        </thead>
                        <tbody class="text-sm">
                            <tr>
                                <td colspan="5" class="px-8 py-32 text-center">
                                    <div class="flex flex-col items-center gap-4 opacity-30">
                                        <i data-lucide="inbox" class="w-16 h-16 text-white"></i>
                                        <p class="text-sm font-black uppercase tracking-[0.5em] text-white">No
                                            registrations found</p>
                                    </div>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- TEAMS ALLOCATION -->
        <div id="view-teams" class="content-view hidden space-y-10">
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
                <!-- No Allocation Cards show by default -->
            </div>

            <div class="portal-card py-32 text-center bg-white/[0.01]">
                <div class="flex flex-col items-center gap-6 opacity-20">
                    <i data-lucide="users" class="w-20 h-20 text-white"></i>
                    <p class="text-sm font-black uppercase tracking-[0.4em] text-white">No teams allocated yet</p>
                </div>
            </div>
        </div>

        <!-- IDEA SUBMISSIONS VIEW -->
        <div id="view-idea" class="content-view hidden">
            <div class="portal-card py-40 text-center">
                <div class="flex flex-col items-center gap-6 opacity-30">
                    <i data-lucide="file-warning" class="w-20 h-20 text-white"></i>
                    <p class="text-sm font-black uppercase tracking-[0.5em] text-white">No concept abstracts detected in
                        system</p>
                </div>
            </div>
        </div>

        <!-- EVALUATOR REGISTRATION VIEW -->
        <div id="view-evaluators" class="content-view hidden max-w-5xl mx-auto">
            <div class="portal-card bg-neon-blue/[0.02] border-neon-blue/20 p-12 space-y-12">
                <div class="text-center space-y-4">
                    <div
                        class="w-20 h-20 bg-neon-blue/10 rounded-3xl mx-auto flex items-center justify-center border border-neon-blue/20 shadow-[0_0_40px_rgba(0,212,255,0.1)]">
                        <i data-lucide="award" class="w-10 h-10 text-neon-blue"></i>
                    </div>
                    <h3 class="text-4xl font-orbitron font-black text-white italic tracking-tighter uppercase">
                        Evaluator Onboarding
                    </h3>
                    <p class="text-white/40 text-sm max-w-lg mx-auto font-medium">Register industry experts and faculty
                        members for the IIC 2K26 Evaluation Panel.</p>
                </div>

                <form id="evaluator-registration-form" class="space-y-10">
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-10">
                        <div class="space-y-3">
                            <label class="text-[10px] font-black text-white/40 uppercase tracking-[0.2em] ml-4">Access
                                Tier</label>
                            <input type="text" value="Expert Evaluator / Judge" readonly class="!opacity-50">
                        </div>
                        <div class="space-y-3">
                            <label class="text-[10px] font-black text-white/40 uppercase tracking-[0.2em] ml-4">Full
                                Legal Name</label>
                            <input type="text" name="name" required placeholder="Prof. John Doe">
                        </div>
                        <div class="space-y-3">
                            <label class="text-[10px] font-black text-white/40 uppercase tracking-[0.2em] ml-4">Email ID
                                (System Identity)</label>
                            <input type="email" name="email" required placeholder="john.doe@institute.edu">
                        </div>
                        <div class="space-y-3">
                            <label
                                class="text-[10px] font-black text-white/40 uppercase tracking-[0.2em] ml-4">Provisionary
                                Password</label>
                            <input type="password" name="password" required placeholder="Set temporary master password">
                        </div>
                    </div>

                    <div class="space-y-8">
                        <label class="text-[10px] font-black text-neon-blue uppercase tracking-[0.3em] ml-4">Assign
                            Expertise Tracks</label>
                        <div class="checkbox-grid">
                            <label class="theme-checkbox"><input type="checkbox" name="tracks" value="Smart Automation"
                                    class="hidden">
                                <div class="box"><i data-lucide="check"></i></div><span
                                    class="text-[11px] font-bold uppercase text-white/70">Smart Automation</span>
                            </label>
                            <label class="theme-checkbox"><input type="checkbox" name="tracks" value="Smart Education"
                                    class="hidden">
                                <div class="box"><i data-lucide="check"></i></div><span
                                    class="text-[11px] font-bold uppercase text-white/70">Smart Education</span>
                            </label>
                            <label class="theme-checkbox"><input type="checkbox" name="tracks" value="Space Technology"
                                    class="hidden">
                                <div class="box"><i data-lucide="check"></i></div><span
                                    class="text-[11px] font-bold uppercase text-white/70">Space Technology</span>
                            </label>
                            <label class="theme-checkbox"><input type="checkbox" name="tracks"
                                    value="Tourism & Hospitality" class="hidden">
                                <div class="box"><i data-lucide="check"></i></div><span
                                    class="text-[11px] font-bold uppercase text-white/70">Tourism & Hospitality</span>
                            </label>
                            <label class="theme-checkbox"><input type="checkbox" name="tracks" value="Smart Vehicles"
                                    class="hidden">
                                <div class="box"><i data-lucide="check"></i></div><span
                                    class="text-[11px] font-bold uppercase text-white/70">Smart Vehicles</span>
                            </label>
                            <label class="theme-checkbox"><input type="checkbox" name="tracks"
                                    value="Heritage & Culture" class="hidden">
                                <div class="box"><i data-lucide="check"></i></div><span
                                    class="text-[11px] font-bold uppercase text-white/70">Heritage & Culture</span>
                            </label>
                            <label class="theme-checkbox"><input type="checkbox" name="tracks" value="Miscellaneous"
                                    class="hidden">
                                <div class="box"><i data-lucide="check"></i></div><span
                                    class="text-[11px] font-bold uppercase text-white/70">Miscellaneous</span>
                            </label>
                            <label class="theme-checkbox"><input type="checkbox" name="tracks" value="Robotics & Drones"
                                    class="hidden">
                                <div class="box"><i data-lucide="check"></i></div><span
                                    class="text-[11px] font-bold uppercase text-white/70">Robotics & Drones</span>
                            </label>
                            <label class="theme-checkbox"><input type="checkbox" name="tracks"
                                    value="Defense / Security" class="hidden">
                                <div class="box"><i data-lucide="check"></i></div><span
                                    class="text-[11px] font-bold uppercase text-white/70">Defense / Security</span>
                            </label>
                            <label class="theme-checkbox"><input type="checkbox" name="tracks"
                                    value="Disaster Management" class="hidden">
                                <div class="box"><i data-lucide="check"></i></div><span
                                    class="text-[11px] font-bold uppercase text-white/70">Disaster Management</span>
                            </label>
                            <label class="theme-checkbox"><input type="checkbox" name="tracks"
                                    value="Transportation & Logistics" class="hidden">
                                <div class="box"><i data-lucide="check"></i></div><span
                                    class="text-[11px] font-bold uppercase text-white/70">Transportation &
                                    Logistics</span>
                            </label>
                            <label class="theme-checkbox"><input type="checkbox" name="tracks"
                                    value="Social Good / Accessibility" class="hidden">
                                <div class="box"><i data-lucide="check"></i></div><span
                                    class="text-[11px] font-bold uppercase text-white/70">Social Good /
                                    Accessibility</span>
                            </label>
                            <label class="theme-checkbox"><input type="checkbox" name="tracks"
                                    value="MedTech / BioTech / HealthTech" class="hidden">
                                <div class="box"><i data-lucide="check"></i></div><span
                                    class="text-[11px] font-bold uppercase text-white/70">MedTech / BioTech /
                                    HealthTech</span>
                            </label>
                            <label class="theme-checkbox"><input type="checkbox" name="tracks"
                                    value="FinTech / Blockchain / Cybersecurity" class="hidden">
                                <div class="box"><i data-lucide="check"></i></div><span
                                    class="text-[11px] font-bold uppercase text-white/70">FinTech / Blockchain /
                                    Cybersecurity</span>
                            </label>
                            <label class="theme-checkbox"><input type="checkbox" name="tracks"
                                    value="Agriculture / FoodTech / Rural Development" class="hidden">
                                <div class="box"><i data-lucide="check"></i></div><span
                                    class="text-[11px] font-bold uppercase text-white/70">Agriculture / FoodTech / Rural
                                    Development</span>
                            </label>
                            <label class="theme-checkbox"><input type="checkbox" name="tracks"
                                    value="Clean & Green Technology" class="hidden">
                                <div class="box"><i data-lucide="check"></i></div><span
                                    class="text-[11px] font-bold uppercase text-white/70">Clean & Green
                                    Technology</span>
                            </label>
                        </div>
                    </div>

                    <button type="submit"
                        class="w-full bg-neon-blue text-dark font-black py-5 rounded-[1.5rem] hover:scale-[1.02] transition-all shadow-xl shadow-neon-blue/30 text-lg uppercase tracking-[0.2em] active:scale-95">Register
                        Evaluator</button>
                </form>

                <script>
                    document.getElementById('evaluator-registration-form').addEventListener('submit', async (e) => {
                        e.preventDefault();
                        const btn = e.target.querySelector('button[type="submit"]');
                        const originalText = btn.innerText;
                        btn.disabled = true;
                        btn.innerText = "Processing...";

                        const tracks = Array.from(e.target.querySelectorAll('input[name="tracks"]:checked')).map(cb => cb.value).join(', ');

                        const data = {
                            action: 'register_user',
                            name: e.target.name.value,
                            email: e.target.email.value,
                            password: e.target.password.value,
                            role: 'evaluator',
                            tracks: tracks
                        };

                        try {
                            const response = await fetch(SCRIPT_URL, {
                                method: 'POST',
                                body: JSON.stringify(data)
                            });
                            const result = await response.json();
                            if (result.status === 'success') {
                                alert('Evaluator Registered Successfully!');
                                e.target.reset();
                            } else {
                                alert('Error: ' + result.message);
                            }
                        } catch (err) {
                            console.error(err);
                            alert('Registration Failed');
                        }
                        btn.disabled = false;
                        btn.innerText = originalText;
                    });
                </script>
            </div>
        </div>

        <!-- EVALUATOR ASSIGNMENT VIEW -->
        <div id="view-assignments" class="content-view hidden space-y-10">
            <div class="portal-card border-none bg-white/[0.02] p-10 space-y-10">
                <div class="flex flex-col gap-2">
                    <h3 class="text-3xl font-orbitron font-black text-white italic tracking-tighter uppercase">Assign
                        Approved Evaluators To Teams</h3>
                    <p class="text-white/40 text-sm font-medium">Link certified industry experts to specific innovation
                        projects.</p>
                </div>

                <div class="flex justify-between items-center p-6 bg-white/[0.04] rounded-3xl border border-white/5">
                    <span class="text-xs font-black uppercase tracking-widest text-white/60">Verified Experts (<span
                            id="evaluators-count">0</span>)</span>
                    <div class="flex gap-4">
                        <select class="!py-2 !px-4 !text-[10px] font-black uppercase tracking-widest !w-auto">
                            <option>Categorical Filter</option>
                            <option>All Experts</option>
                        </select>
                        <select class="!py-2 !px-4 !text-[10px] font-black uppercase tracking-widest !w-auto">
                            <option>All Sections</option>
                        </select>
                    </div>
                </div>

                <div id="evaluators-grid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                    <div class="col-span-full py-32 text-center border-2 border-dashed border-white/5 rounded-[3rem]">
                        <div class="flex flex-col items-center gap-6 opacity-20">
                            <i data-lucide="user-check" class="w-20 h-20 text-white"></i>
                            <p class="text-lg font-black uppercase tracking-[0.5em] text-white">No approved evaluators
                                available</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- SH REGISTRATION VIEW -->
        <div id="view-sh" class="content-view hidden max-w-5xl mx-auto">
            <div class="portal-card bg-neon-purple/[0.02] border-neon-purple/20 p-12 space-y-12">
                <div class="text-center space-y-4">
                    <div
                        class="inline-flex p-5 rounded-3xl bg-neon-purple/10 text-neon-purple border border-neon-purple/20 mb-4">
                        <i data-lucide="shield-plus" class="w-12 h-12"></i>
                    </div>
                    <h3 class="text-4xl font-orbitron font-black text-white italic tracking-tighter uppercase">Admin:
                        Section Head Registration</h3>
                    <p class="text-white/40 text-base font-medium">Commission a new high-level system supervisor for
                        domain oversight.</p>
                </div>

                <form id="sh-registration-form" class="space-y-10">
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-10">
                        <div class="space-y-3">
                            <label class="text-[10px] font-black text-white/40 uppercase tracking-[0.2em] ml-4">Access
                                Tier</label>
                            <input type="text" value="Section Head / Domain Lead" readonly class="!opacity-50">
                        </div>
                        <div class="space-y-3">
                            <label class="text-[10px] font-black text-white/40 uppercase tracking-[0.2em] ml-4">Full
                                Legal Name</label>
                            <input type="text" name="name" required placeholder="Dr. Alice Johnson">
                        </div>
                        <div class="space-y-3">
                            <label class="text-[10px] font-black text-white/40 uppercase tracking-[0.2em] ml-4">Email ID
                                (System Identity)</label>
                            <input type="email" name="email" required placeholder="alice.johnson@institute.edu">
                        </div>
                        <div class="space-y-3">
                            <label
                                class="text-[10px] font-black text-white/40 uppercase tracking-[0.2em] ml-4">Provisionary
                                Password</label>
                            <input type="password" name="password" required placeholder="Set temporary master password">
                        </div>
                    </div>

                    <div class="space-y-8">
                        <label class="text-[10px] font-black text-neon-purple uppercase tracking-[0.3em] ml-4">Assign
                            Supervisory Themes</label>
                        <div class="checkbox-grid">
                            <label class="theme-checkbox"><input type="checkbox" name="tracks" value="Smart Automation"
                                    class="hidden">
                                <div class="box"><i data-lucide="check"></i></div><span
                                    class="text-[11px] font-bold uppercase text-white/70">Smart Automation</span>
                            </label>
                            <label class="theme-checkbox"><input type="checkbox" name="tracks" value="Smart Education"
                                    class="hidden">
                                <div class="box"><i data-lucide="check"></i></div><span
                                    class="text-[11px] font-bold uppercase text-white/70">Smart Education</span>
                            </label>
                            <label class="theme-checkbox"><input type="checkbox" name="tracks" value="Space Technology"
                                    class="hidden">
                                <div class="box"><i data-lucide="check"></i></div><span
                                    class="text-[11px] font-bold uppercase text-white/70">Space Technology</span>
                            </label>
                            <label class="theme-checkbox"><input type="checkbox" name="tracks"
                                    value="Tourism & Hospitality" class="hidden">
                                <div class="box"><i data-lucide="check"></i></div><span
                                    class="text-[11px] font-bold uppercase text-white/70">Tourism & Hospitality</span>
                            </label>
                            <label class="theme-checkbox"><input type="checkbox" name="tracks" value="Smart Vehicles"
                                    class="hidden">
                                <div class="box"><i data-lucide="check"></i></div><span
                                    class="text-[11px] font-bold uppercase text-white/70">Smart Vehicles</span>
                            </label>
                            <label class="theme-checkbox"><input type="checkbox" name="tracks"
                                    value="Heritage & Culture" class="hidden">
                                <div class="box"><i data-lucide="check"></i></div><span
                                    class="text-[11px] font-bold uppercase text-white/70">Heritage & Culture</span>
                            </label>
                            <label class="theme-checkbox"><input type="checkbox" name="tracks" value="Miscellaneous"
                                    class="hidden">
                                <div class="box"><i data-lucide="check"></i></div><span
                                    class="text-[11px] font-bold uppercase text-white/70">Miscellaneous</span>
                            </label>
                            <label class="theme-checkbox"><input type="checkbox" name="tracks" value="Robotics & Drones"
                                    class="hidden">
                                <div class="box"><i data-lucide="check"></i></div><span
                                    class="text-[11px] font-bold uppercase text-white/70">Robotics & Drones</span>
                            </label>
                            <label class="theme-checkbox"><input type="checkbox" name="tracks"
                                    value="Defense / Security" class="hidden">
                                <div class="box"><i data-lucide="check"></i></div><span
                                    class="text-[11px] font-bold uppercase text-white/70">Defense / Security</span>
                            </label>
                            <label class="theme-checkbox"><input type="checkbox" name="tracks"
                                    value="Disaster Management" class="hidden">
                                <div class="box"><i data-lucide="check"></i></div><span
                                    class="text-[11px] font-bold uppercase text-white/70">Disaster Management</span>
                            </label>
                            <label class="theme-checkbox"><input type="checkbox" name="tracks"
                                    value="Transportation & Logistics" class="hidden">
                                <div class="box"><i data-lucide="check"></i></div><span
                                    class="text-[11px] font-bold uppercase text-white/70">Transportation &
                                    Logistics</span>
                            </label>
                            <label class="theme-checkbox"><input type="checkbox" name="tracks"
                                    value="Social Good / Accessibility" class="hidden">
                                <div class="box"><i data-lucide="check"></i></div><span
                                    class="text-[11px] font-bold uppercase text-white/70">Social Good /
                                    Accessibility</span>
                            </label>
                            <label class="theme-checkbox"><input type="checkbox" name="tracks"
                                    value="MedTech / BioTech / HealthTech" class="hidden">
                                <div class="box"><i data-lucide="check"></i></div><span
                                    class="text-[11px] font-bold uppercase text-white/70">MedTech / BioTech /
                                    HealthTech</span>
                            </label>
                            <label class="theme-checkbox"><input type="checkbox" name="tracks"
                                    value="FinTech / Blockchain / Cybersecurity" class="hidden">
                                <div class="box"><i data-lucide="check"></i></div><span
                                    class="text-[11px] font-bold uppercase text-white/70">FinTech / Blockchain /
                                    Cybersecurity</span>
                            </label>
                            <label class="theme-checkbox"><input type="checkbox" name="tracks"
                                    value="Agriculture / FoodTech / Rural Development" class="hidden">
                                <div class="box"><i data-lucide="check"></i></div><span
                                    class="text-[11px] font-bold uppercase text-white/70">Agriculture / FoodTech / Rural
                                    Development</span>
                            </label>
                            <label class="theme-checkbox"><input type="checkbox" name="tracks"
                                    value="Clean & Green Technology" class="hidden">
                                <div class="box"><i data-lucide="check"></i></div><span
                                    class="text-[11px] font-bold uppercase text-white/70">Clean & Green
                                    Technology</span>
                            </label>
                            <label class="theme-checkbox"><input type="checkbox" name="tracks" value="All Tracks"
                                    class="hidden">
                                <div class="box"><i data-lucide="check"></i></div><span
                                    class="text-[11px] font-bold uppercase text-white/70">All / General</span>
                            </label>
                        </div>
                    </div>

                    <button type="submit"
                        class="w-full bg-neon-purple text-white font-black py-5 rounded-[1.5rem] hover:scale-[1.02] transition-all shadow-xl shadow-neon-purple/30 text-lg uppercase tracking-[0.2em] active:scale-95">Register
                        Section Head</button>
                </form>

                <script>
                    document.getElementById('sh-registration-form').addEventListener('submit', async (e) => {
                        e.preventDefault();
                        const btn = e.target.querySelector('button[type="submit"]');
                        const originalText = btn.innerText;
                        btn.disabled = true;
                        btn.innerText = "Processing...";

                        const tracks = Array.from(e.target.querySelectorAll('input[name="tracks"]:checked')).map(cb => cb.value).join(', ');

                        const data = {
                            action: 'register_user',
                            name: e.target.name.value,
                            email: e.target.email.value,
                            password: e.target.password.value,
                            role: 'section-head',
                            tracks: tracks
                        };

                        try {
                            const response = await fetch(SCRIPT_URL, {
                                method: 'POST',
                                body: JSON.stringify(data)
                            });
                            const result = await response.json();
                            if (result.status === 'success') {
                                alert('Section Head Registered Successfully!');
                                e.target.reset();
                            } else {
                                alert('Error: ' + result.message);
                            }
                        } catch (err) {
                            console.error(err);
                            alert('Registration Failed');
                        }
                        btn.disabled = false;
                        btn.innerText = originalText;
                    });
                </script>
            </div>
        </div>

        <!-- NOTICES VIEW (System Announcements) -->
        <div id="view-notices" class="content-view hidden space-y-10">
            <div class="portal-card flex items-center justify-between border-neon-blue/20 bg-neon-blue/[0.01]">
                <div class="flex items-center gap-8">
                    <div
                        class="w-20 h-20 bg-neon-blue/10 rounded-[2rem] flex items-center justify-center text-neon-blue border border-neon-blue/20 shadow-lg shadow-neon-blue/10">
                        <i data-lucide="megaphone" class="w-10 h-10"></i>
                    </div>
                    <div class="flex flex-col">
                        <h3 class="text-4xl font-orbitron font-black text-white italic tracking-tighter uppercase">
                            System Announcements</h3>
                        <p class="text-white/40 text-base font-medium mt-1">Official broadcast feed for all participants
                            and administrators.</p>
                    </div>
                </div>
                <button
                    class="bg-neon-blue text-dark font-black px-10 py-6 rounded-2xl flex items-center gap-3 hover:scale-105 transition-all shadow-xl shadow-neon-blue/20 uppercase tracking-widest text-sm">
                    <i data-lucide="plus-circle" class="w-5 h-5"></i>Create Notice
                </button>
            </div>

            <div class="space-y-8">
                <div class="py-32 text-center border-2 border-dashed border-white/5 rounded-[3rem] bg-white/[0.01]">
                    <div class="flex flex-col items-center gap-6 opacity-20">
                        <i data-lucide="bell-off" class="w-20 h-20 text-white"></i>
                        <p class="text-lg font-black uppercase tracking-[0.5em] text-white">No notices posted yet</p>
                    </div>
                </div>
            </div>
        </div>
        <!-- ASSIGNMENT MODAL -->
        <div id="assignment-modal"
            class="fixed inset-0 z-50 hidden flex items-center justify-center bg-black/80 backdrop-blur-sm">
            <div
                class="bg-[#0a0a0a] border border-white/10 p-8 rounded-[2rem] max-w-2xl w-full mx-4 relative shadow-2xl shadow-neon-blue/20">
                <h3 class="text-2xl font-orbitron font-black text-white italic tracking-tighter uppercase mb-2">Manage
                    Assignments</h3>
                <p class="text-neon-blue text-xs font-bold uppercase tracking-widest mb-6" id="modal-evaluator-name">
                    Assigning to: Evaluator</p>

                <div class="max-h-[60vh] overflow-y-auto pr-2 grid grid-cols-1 md:grid-cols-2 gap-3"
                    id="modal-tracks-container">
                    <!-- Checkboxes injected here -->
                </div>

                <div class="flex gap-4 mt-8 pt-6 border-t border-white/5 justify-end">
                    <button onclick="closeAssignmentModal()"
                        class="px-6 py-3 rounded-xl text-white/60 hover:text-white hover:bg-white/5 text-xs font-black uppercase tracking-widest transition-all">Cancel</button>
                    <button id="save-assignments-btn" onclick="saveAssignments()"
                        class="px-8 py-3 rounded-xl bg-neon-blue text-dark hover:bg-white hover:scale-105 text-xs font-black uppercase tracking-widest transition-all shadow-lg shadow-neon-blue/20">Save
                        Changes</button>
                </div>
            </div>
        </div>
    </main>

    <script src="https://unpkg.com/lucide@latest"></script>
    <script>
        lucide.createIcons();

        function showView(viewId) {
            document.querySelectorAll('.content-view').forEach(v => v.classList.add('hidden'));
            const target = document.getElementById('view-' + viewId);
            if (target) target.classList.remove('hidden');

            document.querySelectorAll('.sidebar-link').forEach(l => {
                l.classList.remove('active');
                if (l.dataset.view === viewId) l.classList.add('active');
            });

            const titles = {
                'dashboard': ['Innovation Dashboard', 'System Overview and Real-time Metrics'],
                'registrations': ['Registration Oversight', 'Reviewing Emerging Innovation Teams'],
                'teams': ['Strategic Allocation', 'Managing Expert-Team Synchronicity'],
                'idea': ['Concept Phase', 'Reviewing Submitted Project Abstracts'],
                'evaluators': ['Expert Certification', 'Evaluator Onboarding & Approval Panel'],
                'assignments': ['Team Assignments', 'Bridging Knowledge and Innovation'],
                'sh': ['Commissioning Panel', 'Administrative Provision of Section Heads'],
                'notices': ['Announcement Feed', 'Global System Broadcasts & Feed']
            };

            if (titles[viewId]) {
                document.getElementById('section-title').innerText = titles[viewId][0];
                document.getElementById('section-subtitle').innerText = titles[viewId][1];
            }
            window.scrollTo(0, 0);
        }

        document.querySelectorAll('.sidebar-link').forEach(l => {
            l.onclick = () => showView(l.dataset.view);
        });
    </script>

    <script>
        // The Script URL must match the one deployed by the user
        const SCRIPT_URL = 'https://script.google.com/macros/s/AKfycby5KouhAElgoNBT48y0ms9Ll_UwGOo9YerzclzidWU3W33PUi5vZEx9y62kgcgGiLxO8Q/exec';

        // Load Data on Start
        document.addEventListener('DOMContentLoaded', () => {
            fetchRegistrations();
            fetchUsers();
        });

        async function fetchUsers() {
            try {
                const response = await fetch(SCRIPT_URL + '?action=get_users');
                const result = await response.json();
                if (result.status === 'success') {
                    const evaluators = result.data.filter(u => u.Role === 'evaluator');
                    renderEvaluators(evaluators);
                }
            } catch (error) {
                console.error("Error fetching users:", error);
            }
        }

        async function fetchRegistrations() {
            console.log("Fetching registrations...");
            const tableBody = document.querySelector('#view-registrations tbody');
            if (tableBody) tableBody.innerHTML = '<tr><td colspan="5" class="text-center py-8 text-white/50">Loading registrations...</td></tr>';

            try {
                // To fetch from GAS, we need CORS enabled (which return ContentService does)
                const response = await fetch(SCRIPT_URL + '?action=get_registrations');
                const result = await response.json();
                console.log("Data fetched:", result);

                if (result.status === 'success') {
                    renderRegistrations(result.data);
                    updateStats(result.data);
                } else {
                    if (tableBody) tableBody.innerHTML = '<tr><td colspan="5" class="text-center py-8 text-red-500">Failed to load data: ' + result.message + '</td></tr>';
                }
            } catch (error) {
                console.error("Fetch Error:", error);
                if (tableBody) tableBody.innerHTML = '<tr><td colspan="5" class="text-center py-8 text-red-500">Error connecting to database. Please check console.</td></tr>';
            }
        }

        function renderRegistrations(data) {
            const tableBody = document.querySelector('#view-registrations tbody');
            if (!tableBody) return;
            tableBody.innerHTML = '';

            if (!data || data.length === 0) {
                tableBody.innerHTML = `
                    <tr>
                        <td colspan="5" class="px-8 py-32 text-center">
                            <div class="flex flex-col items-center gap-4 opacity-30">
                                <i data-lucide="inbox" class="w-16 h-16 text-white"></i>
                                <p class="text-sm font-black uppercase tracking-[0.5em] text-white">No registrations found</p>
                            </div>
                        </td>
                    </tr>`;
                lucide.createIcons();
                return;
            }

            data.forEach(team => {
                const tr = document.createElement('tr');
                tr.className = 'border-b border-white/5 hover:bg-white/[0.02] transition-colors';

                const statusSpan = document.createElement('span');
                const actionsDiv = document.createElement('div');
                actionsDiv.className = 'flex items-center justify-center gap-2';

                if (team['Approval Status'] === 'Approved') {
                    statusSpan.className = 'px-3 py-1 rounded-full bg-green-500/10 text-green-500 border border-green-500/20 text-[10px] font-black uppercase tracking-widest';
                    statusSpan.innerText = 'Approved';
                } else if (team['Approval Status'] === 'Rejected') {
                    statusSpan.className = 'px-3 py-1 rounded-full bg-red-500/10 text-red-500 border border-red-500/20 text-[10px] font-black uppercase tracking-widest';
                    statusSpan.innerText = 'Rejected';
                } else {
                    statusSpan.className = 'px-3 py-1 rounded-full bg-yellow-500/10 text-yellow-500 border border-yellow-500/20 text-[10px] font-black uppercase tracking-widest';
                    statusSpan.innerText = 'Pending';

                    // Approve button
                    const approveBtn = document.createElement('button');
                    approveBtn.title = 'Approve';
                    approveBtn.className = 'w-8 h-8 rounded-lg bg-green-500/10 text-green-500 flex items-center justify-center hover:bg-green-500 hover:text-dark transition-all';
                    approveBtn.innerHTML = '<i data-lucide="check" class="w-4 h-4"></i>';
                    approveBtn.onclick = () => approveTeam(team['_rowIndex'], team['Team Name']);
                    actionsDiv.appendChild(approveBtn);

                    // Reject button
                    const rejectBtn = document.createElement('button');
                    rejectBtn.title = 'Reject';
                    rejectBtn.className = 'w-8 h-8 rounded-lg bg-red-500/10 text-red-500 flex items-center justify-center hover:bg-red-500 hover:text-white transition-all';
                    rejectBtn.innerHTML = '<i data-lucide="x" class="w-4 h-4"></i>';
                    rejectBtn.onclick = () => rejectTeam(team['_rowIndex'], team['Team Name']);
                    actionsDiv.appendChild(rejectBtn);
                }

                // View screenshot button (always shown)
                const viewBtn = document.createElement('button');
                viewBtn.title = 'View Screenshot';
                viewBtn.className = 'w-8 h-8 rounded-lg bg-blue-500/10 text-blue-500 flex items-center justify-center hover:bg-blue-500 hover:text-white transition-all';
                viewBtn.innerHTML = '<i data-lucide="eye" class="w-4 h-4"></i>';
                viewBtn.onclick = () => {
                    const link = team['Screenshot Drive Link'];
                    if (link && link.includes('http')) {
                        window.open(link, '_blank');
                    } else {
                        alert('No screenshot available');
                    }
                };
                actionsDiv.appendChild(viewBtn);

                tr.innerHTML = `
                    <td class="px-8 py-5">
                        <div class="flex flex-col">
                            <span class="font-bold text-white">${team['Team Name'] || 'Unknown Team'}</span>
                            <span class="text-xs text-white/50">${team['Institution'] || '-'}</span>
                        </div>
                    </td>
                    <td class="px-8 py-5">
                        <div class="flex flex-col">
                            <span class="text-sm text-white">${team['Team Leader Name'] || '-'}</span>
                            <span class="text-xs text-white/50">${team['Leader Email'] || '-'}</span>
                        </div>
                    </td>
                    <td class="px-8 py-5 text-sm text-white/70">${team['Innovation Track'] || '-'}</td>
                    <td class="px-8 py-5" id="status-cell-${team['_rowIndex']}"></td>
                    <td class="px-8 py-5 text-center" id="actions-cell-${team['_rowIndex']}"></td>
                `;

                tableBody.appendChild(tr);

                // Now inject the DOM elements into the correct cells
                const statusCell = tr.querySelector(`#status-cell-${team['_rowIndex']}`);
                const actionsCell = tr.querySelector(`#actions-cell-${team['_rowIndex']}`);
                if (statusCell) statusCell.appendChild(statusSpan);
                if (actionsCell) actionsCell.appendChild(actionsDiv);
            });
            lucide.createIcons();
        }

        function renderEvaluators(evaluators) {
            const grid = document.getElementById('evaluators-grid');
            const countSpan = document.getElementById('evaluators-count');

            if (countSpan) countSpan.innerText = evaluators.length;
            if (!grid) return;

            if (evaluators.length === 0) {
                grid.innerHTML = `
                <div class="col-span-full py-32 text-center border-2 border-dashed border-white/5 rounded-[3rem]">
                    <div class="flex flex-col items-center gap-6 opacity-20">
                        <i data-lucide="user-check" class="w-20 h-20 text-white"></i>
                        <p class="text-lg font-black uppercase tracking-[0.5em] text-white">No approved evaluators available</p>
                    </div>
                </div>`;
                lucide.createIcons();
                return;
            }

            grid.innerHTML = '';
            evaluators.forEach(user => {
                const card = document.createElement('div');
                card.className = 'portal-card bg-white/[0.02] border-white/5 p-6 space-y-4 hover:border-neon-blue/30 transition-all group';

                const initials = user.Name ? user.Name.slice(0, 2).toUpperCase() : 'EV';

                const button = document.createElement('button');
                button.className = "w-full py-3 mt-2 rounded-xl bg-white/5 hover:bg-white/10 text-[10px] font-black uppercase tracking-widest text-white transition-all flex items-center justify-center gap-2";
                button.innerHTML = '<i data-lucide="edit-2" class="w-3 h-3"></i> Manage Assignments';
                button.onclick = () => openAssignmentModal(user.Email, user.Name, user.Assigned_Tracks);

                card.innerHTML = `
                    <div class="flex items-center justify-between">
                        <div class="w-12 h-12 rounded-xl bg-gradient-to-br from-neon-blue to-neon-purple flex items-center justify-center text-white font-black">
                            ${initials}
                        </div>
                        <span class="px-3 py-1 rounded-full bg-green-500/10 text-green-500 border border-green-500/20 text-[10px] font-black uppercase tracking-widest">Active</span>
                    </div>
                    <div>
                        <h4 class="text-lg font-bold text-white group-hover:text-neon-blue transition-colors">${user.Name || 'Unknown Evaluator'}</h4>
                        <p class="text-xs text-white/40 font-mono mt-1">${user.Email}</p>
                    </div>
                    <div class="pt-4 border-t border-white/5">
                        <span class="text-[10px] font-black text-white/30 uppercase tracking-widest block mb-2">Assigned Tracks</span>
                        <p class="text-sm font-bold text-white">${user.Assigned_Tracks || 'None'}</p>
                    </div>
                `;
                card.appendChild(button);
                grid.appendChild(card);
            });
            lucide.createIcons();
        }

        // --- ASSIGNMENT MODAL LOGIC ---
        const ALL_TRACKS = [
            'Smart Automation (SDG 9)',
            'Smart Education (SDG 4)',
            'Space Technology (SDG 13)',
            'Tourism & Hospitality (SDG 8)',
            'Smart Vehicles (SDG 7)',
            'Heritage & Culture (SDG 16)',
            'Miscellaneous (SDG)',
            'Robotics & Drones (SDG 15)',
            'Defense / Security (SDG 16)',
            'Disaster Management (SDG 13)',
            'Transportation & Logistics (SDG 11)',
            'Social Good / Accessibility (SDG 10)',
            'MedTech / BioTech / HealthTech (SDG 3)',
            'FinTech / Blockchain / Cybersecurity (SDG 16)',
            'Agriculture / FoodTech / Rural Development (SDG 1, SDG 2)',
            'Clean & Green Technology (Renewable Energy, Sustainability) (SDG 7)'
        ];

        let currentEditingEmail = null;

        function openAssignmentModal(email, name, currentTracks) {
            currentEditingEmail = email;
            const modal = document.getElementById('assignment-modal');
            const title = document.getElementById('modal-evaluator-name');
            const container = document.getElementById('modal-tracks-container');

            title.innerText = `Assigning to: ${name} `;
            modal.classList.remove('hidden');

            // Populate Tracks
            container.innerHTML = '';
            const assigned = currentTracks ? currentTracks.split(',').map(t => t.trim()) : [];

            ALL_TRACKS.forEach(track => {
                const label = document.createElement('label');
                label.className = 'flex items-center gap-3 p-3 rounded-xl bg-white/5 hover:bg-white/10 cursor-pointer transition-all border border-transparent hover:border-neon-blue/30';

                const checkbox = document.createElement('input');
                checkbox.type = 'checkbox';
                checkbox.value = track;
                checkbox.checked = assigned.includes(track) || assigned.includes('All') || assigned.includes('All Experts');
                checkbox.className = 'w-4 h-4 rounded accent-neon-blue bg-dark border-white/20';

                const span = document.createElement('span');
                span.className = 'text-xs font-bold text-white/80';
                span.innerText = track;

                label.appendChild(checkbox);
                label.appendChild(span);
                container.appendChild(label);
            });
        }

        function closeAssignmentModal() {
            document.getElementById('assignment-modal').classList.add('hidden');
            currentEditingEmail = null;
        }

        async function saveAssignments() {
            if (!currentEditingEmail) return;

            const btn = document.getElementById('save-assignments-btn');
            const originalText = btn.innerText;
            btn.innerText = "Saving...";
            btn.disabled = true;

            // Collect selected tracks
            const checkboxes = document.querySelectorAll('#modal-tracks-container input[type="checkbox"]:checked');
            const selectedTracks = Array.from(checkboxes).map(cb => cb.value).join(', ');

            try {
                const response = await fetch(SCRIPT_URL, {
                    method: 'POST',
                    body: JSON.stringify({
                        action: 'update_evaluator',
                        email: currentEditingEmail,
                        tracks: selectedTracks || 'None'
                    })
                });

                const result = await response.json();

                if (result.status === 'success') {
                    alert('Assignments Updated Successfully!');
                    closeAssignmentModal();
                    fetchUsers(); // Refresh list
                } else {
                    alert('Error: ' + result.message);
                }
            } catch (err) {
                console.error(err);
                alert('Connection Failed');
            } finally {
                btn.innerText = originalText;
                btn.disabled = false;
            }
        }



        async function approveTeam(rowIndex, teamName) {
            if (!confirm(`Are you sure you want to approve team "${teamName}" ? `)) return;

            document.body.style.cursor = 'wait';

            try {
                const response = await fetch(SCRIPT_URL, {
                    method: 'POST',
                    body: JSON.stringify({
                        action: 'approve',
                        rowIndex: rowIndex,
                        teamName: teamName
                    })
                });

                const result = await response.json();
                document.body.style.cursor = 'default';

                if (result.status === 'success') {
                    alert(`Team "${teamName}" Approved Successfully! Email sent.`);
                    fetchRegistrations(); // Refresh list
                } else {
                    alert('Error: ' + result.message);
                }
            } catch (error) {
                console.error(error);
                document.body.style.cursor = 'default';
                alert('Connection Failed');
            }
        }

        async function rejectTeam(rowIndex, teamName) {
            if (!confirm(`Are you sure you want to reject team "${teamName}"?`)) return;

            document.body.style.cursor = 'wait';

            try {
                const response = await fetch(SCRIPT_URL, {
                    method: 'POST',
                    body: JSON.stringify({
                        action: 'reject',
                        rowIndex: rowIndex,
                        teamName: teamName
                    })
                });

                const result = await response.json();
                document.body.style.cursor = 'default';

                if (result.status === 'success') {
                    alert(`Team "${teamName}" has been Rejected.`);
                    fetchRegistrations(); // Refresh list
                } else {
                    alert('Error: ' + result.message);
                }
            } catch (error) {
                console.error(error);
                document.body.style.cursor = 'default';
                alert('Connection Failed');
            }
        }

        function updateStats(data) {
            const total = data.length;
            const approved = data.filter(d => d['Approval Status'] === 'Approved').length;
            const pending = data.filter(d => d['Approval Status'] === 'Pending').length;

            // Update Dashboard Counters (by finding texts, effectively hardcoded selectors based on previous file content)
            const cards = document.querySelectorAll('#view-dashboard .portal-card .text-4xl');
            // Assuming order: Total Teams, Total Apps, Pending, Selected, Rejected...
            if (cards.length > 0) cards[0].innerText = total;
            if (cards.length > 1) cards[1].innerText = total;
            if (cards.length > 2) cards[2].innerText = pending;
            if (cards.length > 3) cards[3].innerText = approved;
        }

    </script>
</body>

</html>